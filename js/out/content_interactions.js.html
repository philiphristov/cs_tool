<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>VerbaAlpina Crowdsourcing Tool - Documentation Source: content_interactions.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">VerbaAlpina Crowdsourcing Tool - Documentation</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-Ajax_Calls.html">Ajax_Calls</a></li><li><a href="module-Content_Interactions.html">Content_Interactions</a></li><li><a href="module-Geo_Parser.html">Geo_Parser</a></li><li><a href="module-Map-Objects_Generator.html">Map-Objects_Generator</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: content_interactions.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 * @module Content_Interactions
 * 
 * 
 */

var welcome_texts = ["Willkommen.","Bienvenue.","Benvenuto.","Dobrodoš​‌li."];

var slogan_texts = ["Sprich die Sprache der Alpen!","Parlons la langue des Alpes!","Parliamo la lingua delle Alpi!","Govori jezik Alp!"];

var language_texts = ["Sprache ...","Langue ...","Lingua ...","Jezik ..."];

var languages = ["Deutsch","Français","Italiano","Slovenščina"];

var instruction_texts =[
'Verraten Sie uns, wie Sie zu bestimmten almwirtschaftlichen Begriffen sagen! Wählen Sie dazu Ihre Gemeinde und einen der vorgegebenen Begriffe aus und tragen Sie im Antwortfeld eine Bezeichnung ein. Vor besonders wichtigen Begriffen steht ein “!“. Die von Ihnen eingetragenen Wörter werden auf der Karte in grün markiert; die Wörter von anderen Personen sind blau markiert. Durch Klick auf den jeweiligen Eintrag können Sie diesen ändern oder löschen. Setzen Sie eventuelle Anmerkungen bitte in Klammern! Falls nötig, können Sie mehrere Bezeichnungen nennen und diese durch ein Komma trennen. Wir würden uns freuen, wenn Sie sich im Anschluss registrieren würden, um ihre Ergebnisse zu speichern. Je mehr Wörter Sie eintragen, umso besser - und kommen Sie jederzeit gerne wieder!',
'Aidez-nous à mieux connaître le langage alpin! Sélectionnez votre commune et un des concepts proposés; insérez ensuite le mot dialectal dans la case réponse. Devant des concepts particulièrement importants se trouve un “!”. Les mots que vous insérez apparaissent sur la carte sous forme de symboles verts; les mots insérés par d\'autres personnes sont symbolisés en bleu. Mettez des commentaires éventuels entre parenthèses, s´il vous plaît! Si nécessaire, vous pouvez insérer plusieurs mots et les séparer par une virgule. Enfin, nous vous remercierions de vous enregistrer pour mémoriser vos résultats. Plus mots vous insérez, mieux c`est - Vous serez toujours le bienvenu à la page!', 
'Aiutateci a conoscere meglio il linguaggio alpino! Scegliete il vostro comune e uno dei concetti proposti e inserite la parola dialettale nel campo risposta. Davanti a concetti di particolare importanza si trova un “!”. Le parole che inserite appariranno sulla carta evidenziate in verde; le parole inserite da altre persone sono evidenziate in blu. Cliccando su vostro contributo potete cambiarlo o cancellarlo. Mettete eventuali commenti fra parentesi, per favore! Se necessario, potete inserire parecchie parole e separarle con una virgola. Poi saremmo lieti se vi registrate per memorizzare i vostri risultati. Più parole inserite, meglio è - Siete sempre benvenuti ogni volta che tornate sul sito!',
'Pomagajte nam bolje spoznati alpski jezik! Izberite svoj kraj in enega od danih pojmov ter v polje za odgovor vnesite oznako. Pred posebno pomembnimi pojmi se nahaja ”!”. Besede, ki jih boste vnesli, bodo na karti prikazane zeleno; odgovori drugih oseb bodo modre barve. Klikajoč konkreten vpis lahko ga spremenite ali izbrišete. Prosimo, da morebitne pripombe postavite v oklepaje. Če je potrebno, jih lahko označite več in jih med seboj ločite z vejico. Prosimo, da se na koncu registrirate in tako shranite svoje podatke. Čim več konceptov vnesete tem bolje -in se vračajte k nam kadarkoli!']

var instruction_heads = [
"Anleitung",
"Instructions",
"Istruzioni",
"Navodila"
]

var go_texts = [
"Los geht's",
"Allons-y!",
"Via!",
"Gremo!"
]

var the_word_concept = [
"Begriff",
"concept",
"concetto",
"reče"
]


var concept_select_texts = [
"Wählen Sie einen Begriff aus.",
"Sélectionnez un mot.",
"Scegliete una parola.",
"Izberite pojem!"
]

var input_select_texts = [
"Tragen Sie eine Antwort ein.",
"Insérez une réponse.",
"Inserite una risposta.",
"Vnesite odgovor!"
];


var location_select_texts = [
"Wählen Sie eine Gemeinde aus.",
"Sélectionnez une commune.",
"Scegliete un comune.",
"Izberite občino!"
];

var location_select_texts_with_br = [
"Wählen Sie eine &lt;br> Gemeinde aus.",
"Sélectionnez &lt;br> une commune.",
"Scegliete &lt;br> un comune.",
"Izberite občino!"
];

var submit_texts = [
"Abschicken!",
"Envoyer!",
"Inviare!",
"Pošlij!"
];

var anonymous_texts =[
"Anonym",
"Anonyme",
"Anonimo",
"Anonimen"
]

var important_concepts_texts = [
"Wichtiger Begriff",
"Concept important",
"Concetto importante",
"Važni pojem"
]


var tooltips = 

[
  {name:"#word_span",array:concept_select_texts},
  {name:"#location_span",array:location_select_texts},
  {name:"#user_input",array:input_select_texts},
  {name:"#submitanswer",array:submit_texts},

];

var leftmenu_contents = [
"#left_menu_content_ger",
"#left_menu_content_fr",
"#left_menu_content_ita",
"#left_menu_content_slo"
];

var welcomeback_texts =[
"Willkommen &lt;br> zurück.",
"Merci d\'être &lt;br> revenu!",
"Grazie di &lt;br> essere tornato! ",
"Dobrodošli &lt;br> ponovno!"
]

var register_texts = [
"Jetzt anmelden!",
"Enregistrer / Login",
"Registrare / Login",
"Registracija / Prijava"
]

var random_texts =[
"Zufälliger Begriff",
"Concept aléatoire",
"Concetto casuale",
"Naključen pojem"
]

var suggest_texts = [
"Begriff vorschlagen",
"Proposer un concept",
"Proporre un concetto",
"Predlagaj pojem"
]

var active_user_texts =[
"Aktivste User",
"Participants les plus actifs",
"Partecipanti i più attivi",
"Najbolj aktivni uporabniki"
]

var active_location_texts =[
"Aktivste Gemeinden",
"Communes les plus actives",
"Comuni i più attivi",
"Najbolj aktivne občine "
]

var active_concept_texts  =[
"Beliebteste Begriffe",
"Concepts les plus populaires",
"Communes les plus actives",
"Najbolj priljubljeni pojmi"
]


var register_head_texts = [
"Warum Registrieren?",
"Pourquoi enregistrer?",
"Perché registrare?",
"Zakaj registracija? "
]

var register_body_texts = [
"Sie haben dauerhaften Zugriff auf Ihre Daten. &lt;br> Sie können VerbaAlpina Champion werden. &lt;br> Sie erhalten aktuelle Infos über neue Funktionen und die Community. &lt;br> Sie können neue Begriffe vorschlagen.",
"Vous avez accès permanent à vos données. &lt;br> Vous pouvez devenir champion de VerbaAlpina. &lt;br> Vous recevez des informations actuelles sur des fonctions nouvelles et la communauté de VerbaAlpina. &lt;br> Vous pouvez proposer des concepts nouveaux.",
"Avete accesso permanente ai vostri dati. &lt;br> Potete diventare campione di VerbaAlpina. &lt;br> Ricevete informazioni attuali su nuove funzioni e la communità di VerbaAlpina. &lt;br> Potete proporre nuovi concetti.",
"Omogoča stalen dostop do vaših podatkov. &lt;br> Lahko postanete zmagovalec/ka VerbaAlpine. &lt;br> Z registracijo boste prejemali aktualne informacije o novih funkcijah spletne strani in skupnosti VerbaAlpina. &lt;br> Lahko predlagate nove pojme."
]

var register_yes_texts = [
"Jetzt registrieren!",
"Enregistrer maintenant!",
"Registrare adesso!",
"Registrirajte se zdaj!"
]

var register_no_texts = [
"Nein, Danke!",
"Non, merci!",
"No, grazie!",
"Ne, hvala!"
]

var feedback_texts = [
"Danke, Ihr Vorschlag wird geprüft!",
"Grazie, la vostra proposta viene esaminata!",
"Merci, votre proposition est examinée!",
"Thank you, your proposal will be checked!"
]

var permanently_saved = [
"Dauerhaft gespeichert",
"Mémorisé de manière permanente",
"Memorizzato permanentemente",
"Saved Permanently"
];

var break_cycle = false;

/**
 * Saves the language choosen by the user from the modal. 0 - German, 1 - French, 2 - Italian, 3 - Slovenian
 * @type {Number}
 */
var current_language = 0;

var selectbox;

/**
 * Array of all concepts and their ids in the current language choosen.
 * @type {Array}
 */
var concepts_cur_lang;

/**
 * An indexed array containing concept name and the concept id as the array index.
 */
var concepts_index_by_id;

/**
 * Index array of user entered answers. Index - Concept Id, Number of user Input of the assosiated concept.
 */
var num_of_answers_by_id;

/**
 * Array with all data for the locations data table.
 * @type {Array}
 */
var location_data;

var allow_select = false;

var offsetHeight = 0;
var old_doc_width =0;

var modals_initialized = false;
var locations_modal_modals_initialized=false;
var concepts_modal_initialized = false;

var do_image_modal;


var tutorial_running = false;
var location_selected = false;
var concept_selected = false;
var word_entered =false;
var stage = 0;
var process_restarted = false;

var centerCoordinates_locations = [];


var saved_location_index = -1;
var saved_location_name;
var current_concept_index = -1;


var geo_data;
var aeusserungen_test;
var count_aeusserung_per_location;
var indexed_location_aeusserungen_array;
var aeusserungen_by_locationindex;
var unanswered_concepts;
var current_location_list_table_data;
var current_location_list_table;
var current_location_list_object;
var prevent_randomclick = false;

var datatable_locations;
var datatable_concepts;

var session_answer_count =0;

var top_locations;
var top_concepts;
var top_users;
var current_highscoredata;
var current_top_list_table;
var prevent_backdrop = false;

/**
 * Initializes UI elements according to the browser. Sets the map in the center of the browser. 
 *
 */
function initTool(){

    // google.maps.event.addListener(map, 'dragend', function() { console.log(map.getCenter().lat()); console.log(map.getCenter().lng());} );

    // var left_menu = document.getElementById('left_menu');
    // map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(left_menu);

    /*console.log(current_user);
    console.log("Language is set: " + language_is_set);*/


    calculateCenter();

    offsetHeight = jQuery('#left_menu').outerHeight();  

    google.maps.event.addDomListener(window, 'resize', function() {
     
    map.setCenter(center);
    setDynamicContent();

    });




  addModalListeners(); 


 /* if(!language_is_set){ 
    current_language=-1;
    initWelcomeModal();

     jQuery('#welcome_modal').modal({
      backdrop: 'static',
      keyboard: false
   })
    console.log(language_is_set);

  }else{ 

   setRandomTitelImage();   
   jQuery('#welcomeback_modal').find('#modal_welcome').html(welcomeback_texts[current_language]); 
   jQuery('#welcomeback_modal').modal({
      keyboard: false
   })

  console.log(language_is_set);   
   
  }*/
  if(language_is_set){
    
   current_language = parseInt(crowder_lang);

   setRandomTitelImage(function(){   
   jQuery('#welcomeback_modal').find('#modal_welcome').html(welcomeback_texts[current_language]); 
   jQuery('#welcomeback_modal').modal({
      keyboard: false
   })

  },".welcome_modal");

  //console.log("True:" + language_is_set);   
  }else{
    current_language=-1;
    initWelcomeModal();

      setRandomTitelImage(function(){
        
         jQuery('#welcome_modal').modal({
          backdrop: 'static',
          keyboard: false
       })

    },".welcome_modal");

  }
  

}   

/**
 * Ajusts HTML-Elemets size according to the browser.
 * 
 */
function setDynamicContent(source){


         var doc_width =   jQuery(document).width();
         var doc_height =  jQuery(document).height();

          offsetHeight = jQuery('#left_menu').outerHeight();  //update height for leftmenu

            if(doc_width&lt;=330){

            jQuery('#left_menu').css('padding-left',"9px").css('padding-right',"0px");
            jQuery('.row_2').css('text-align','center');

            }

            else{
            jQuery('#left_menu').css('padding-left',"20px").css('padding-right',"20px");  
            jQuery('.row_2').css('text-align','right');
      
 
            }


         if(doc_width&lt;576){
          jQuery('.row_1').css('font-size',"17px");
          jQuery('.row_2').css('font-size',"17px").css('margin-left',"0px");

         }

        if(doc_width>1400){
          jQuery('.row_1').css('font-size',"48px");
          jQuery('.row_2').css('font-size',"48px");


        }

        else if (doc_width&lt;1200&amp;&amp;doc_width>576){
          jQuery('.row_1').css('font-size',"3vw");
          jQuery('.row_2').css('font-size',"3vw");

         }


            if(jQuery('#image_modal').hasClass('in')){

             jQuery('#image_modal').find('.i_fake_body').height('65vh');
       
              var modal_margin = 30;
              if(doc_width&lt;576) modal_margin = 10;

        
              var modal_height = jQuery('#image_modal').find('.i_fake_body').height()+23 + modal_margin;  //23 = footer, 30 = margin top
              var offsetHeight_l = document.getElementById('left_menu').offsetHeight + 20;  //20 = before;

              var margin = 15;
        
              if((modal_height+offsetHeight_l) > doc_height)  {

                var dif = doc_height-(modal_height+offsetHeight_l);
                var current_height = jQuery('#image_modal').find('.i_fake_body').height();
                var new_height =  current_height+dif-margin;
                jQuery('#image_modal').find('.i_fake_body').height(new_height);
               
              }

            }

          if(source!='image') {

   

          for(var i=0;i&lt;tooltips.length;i++){
             jQuery(tooltips[i].name).popover('dispose');
           }

         addToolTips(tooltips);

         if(jQuery('.login_popover').parent().parent().hasClass('in')){

          jQuery('#icon_login').popover('dispose');
          addLoginToolTip();
          showLoginPopUp();

          }
      

         if(jQuery('.list_modal').hasClass('in')){

          displayTooltips(false);
          if(modals_initialized){
           reMeasureDatatables();
          }
        }


            if(doc_width&lt;485){

            var offsetstring = "0 0";

            if(current_language==0){

              if(doc_width&lt;338 &amp;&amp; doc_width>329){offsetstring = "0 -10";}
              if(doc_width&lt;323)offsetstring = "0 20";
              if(doc_width&lt;307){offsetstring = "0 -25";}

            }

            if(current_language==1){
             if(doc_width&lt;451)offsetstring = "0 -20";
            }

            if(current_language==2){
             if(doc_width&lt;315)offsetstring = "0 10";
             if(doc_width&lt;302)offsetstring = "0 -20";
            }



        jQuery('#location_span').popover('dispose');
                          
              jQuery('#location_span').popover({
              trigger:"manual",
              placement:"top",
              container:"body",
              html:true,
              content:'&lt;div class="pop_location_span custom_popover_content">'+location_select_texts_with_br[current_language]+'&lt;/div>',
              offset:offsetstring,
              animation:true
         
              });

              if(stage==1){

                jQuery('#location_span').popover('show');

                   jQuery('.pop_location_span').parent().on('click',function(){
                    handleLocationSpanClick();
                  }).addClass('c_hover');  

              }         
          

            }


            else{

            jQuery('#location_span').popover('dispose');
            addToolTip('#location_span',location_select_texts);

            }

            if(stage==4){
                jQuery('#submitanswer').popover('show');

                    jQuery('.pop_submitanswer').parent().on('click',function(){

                    if(!submit_button_clicked){
                      saveWord();
                      submit_button_clicked = true;
                      setTimeout(function(){ submit_button_clicked = false; console.log('submit button: After saveword() ' + submit_button_clicked);}, 1000);
                    }

                }).addClass('c_hover');  

              } 


          if(source!="list")showPopUp();

        } 

        if(old_doc_width>575 &amp;&amp;doc_width&lt;575){

          reMeasureDatatables();
        }

        else if(old_doc_width&lt;575 &amp;&amp;doc_width>575){
          reMeasureDatatables();
        }

        if(doc_width&lt;452){
          jQuery('#register_modal .custom-modal-footer button').css('font-size',"10px");
          jQuery('#register_modal .modal-body').css('padding-right',"2px");
        }
        else{
          jQuery('#register_modal .custom-modal-footer button').css('font-size',"14px");
          jQuery('#register_modal .modal-body').css('padding-right',"10px");
        }
        

      old_doc_width = doc_width;

}
/**
 * Initializes the CS-Tool. Performes Ajax Calls to fetch data(locations, user entries) from the server. The gathered data is then stored in global variables.
 */
function startMainTool(){


create_cookie(current_language);

var menu_content = jQuery(leftmenu_contents[current_language]);

jQuery('#left_menu').append(menu_content);
menu_content.show();
if(!language_is_set)showCustomBackdrop();

  jQuery('#submitanswer').on('click', function(){
    console.log('submit button: Before saveword() ' + submit_button_clicked);

    if(!submit_button_clicked){
      saveWord();
      submit_button_clicked = true;
      setTimeout(function(){ submit_button_clicked = false; console.log('submit button: After saveword() ' + submit_button_clicked);}, 1000);
        //  console.log( JSON.stringify(submitedAnswers));
    
    }

  })

  /*set user language -> to be saved as current_language in the wp_db*/
  if(!language_is_set){ // (crowder_lang/*.localeCompare("") == 0*/ || current_language != crowder_lang || /*crowder_lang.localeCompare("-1") ||*/ crowder_lang == -1 ) &amp;&amp; userLoggedIn

    jQuery.ajax({
                      url: ajax_object.ajax_url,
                      type: 'POST',
                      data: {
                        action : 'save_lang_for_user',
                        lang : current_language
                      },
                      success : function( response ) {
                        console.log("language saved"); 
                        console.log("Saved language: " + JSON.parse(response));
                    }
    });
  }

  /*ajax call to get all locations in the choosen language*/

/**
 * Get locations in current language
 * @async
 * @function getTableData
 */
jQuery.ajax({
            url: ajax_object.ajax_url,
            type: 'POST',
            data: {
              action : 'getlocations',
              lang : current_language
            },
            success : function( response ) {
              locations = JSON.parse(response);

              location_data = getTableData(locations,"location");
              initLocationsModal();


    /**
     * Get Aeusserungen and the Manicipilities associated
     * @async
     * @function getTableData
     */
			jQuery.ajax({
                    url: ajax_object.ajax_url,
                    type: 'POST',
                    data: {
                      action : 'getAuesserungen_geoData',
                      lang : current_language
                    },
                    success : function( response ) {
                      var arr = JSON.parse(response);

              jQuery.ajax({
                  url: ajax_object.ajax_url,
                  type: 'POST',
                  data: {
                    action : 'check_user_status',
                  },
                  success : function( response ) {
                  var can_do = JSON.parse(response);
                  //console.log(can_do);
                  var is_admin = can_do.can_edit;
                  
                     aeusserungen = arr.aeusserungen;
                     count_aeusserung_per_location = arr.locations_aeusserungen_count;
                     indexed_location_aeusserungen_array = arr.locations_aeusserungen_count;
                      
                     get_aeussetungen_locations_curLang(indexed_location_aeusserungen_array,is_admin);
                     aeusserungen_by_locationindex = build_indexed_aeusserungen_array(aeusserungen);
      
                     fill_submitted_answers(aeusserungen);
                     submitedAnswers_indexed = create_submited_answers_index_array(aeusserungen,is_admin);
                     num_of_answers_by_id = createAnswersToEntryNumbers(submitedAnswers_indexed);
                     checkEnteredConcepts_indexed(); 
                     unanswered_concepts = createUnansweredIndex(); 

                        if(!userLoggedIn){
                          addLoginToolTip();
                          startLoginTimer();
                         }  

                     check_user_aeusserungen();
              }});
            
        }});

  }});


  /*ajax call for all the concepts in the choosen language*/
  jQuery.ajax({
      url: ajax_object.ajax_url,
      type: 'POST',
      data: {
        action : 'getKonzepte',
        lang : current_language
      },
      success : function( response ) {
        concepts_cur_lang = JSON.parse(response);
  
        concept_data = getTableData(concepts_cur_lang,"concept");
        initConceptModal();

        allow_select = true;
        /*console.log('concepts_cur_lang');
        console.log(concepts_cur_lang);*/
        concepts_index_by_id = createConceptIndexList(concepts_cur_lang);
        
/*        console.log('concepts_index_by_id');
        console.log(concepts_index_by_id);*/


// google.maps.event.addListener(map, 'mousemove', function (event) {
//               // displayCoordinates(event.latLng);               
//           });



setDynamicContent();
jQuery('#left_menu').css('opacity','0');
jQuery('#left_menu').show();
offsetHeight = document.getElementById('left_menu').offsetHeight;
jQuery('#left_menu').css('bottom',-offsetHeight);

jQuery('#left_menu').css('opacity','1');
jQuery('#left_menu').animate({ bottom: '+='+offsetHeight }, 400,'swing', function() {

menu_is_up();


});


  jQuery('#left_menu').hammer().bind("swipedown", function(){
    if(jQuery(this).is(':visible')){
        jQuery(this).animate({ bottom: '-='+offsetHeight }, 400,'swing',function(){jQuery(this).hide();jQuery('#fake_arrow').show();}); 
        jQuery('.popover').hide();
     }
  });

  jQuery('#swipe-up-div').hammer().bind("swipedown", function(){
    if(jQuery('#left_menu').is(':visible')){
      jQuery('#left_menu').animate({ bottom: '-='+offsetHeight }, 400,'swing',function(){jQuery('#left_menu').hide();jQuery('#fake_arrow').show();});
      jQuery('.popover').hide();
    }  
    }); 


    jQuery('#swipe-up-div').hammer().bind("swipeup", function(){
    if(jQuery('#left_menu').is(':hidden')){
      jQuery('#left_menu').show().animate({ bottom: '+='+offsetHeight }, 400,'swing',function(){jQuery('.popover').show();});
      jQuery('#fake_arrow').hide();
    }  
    });

    jQuery('#fake_arrow').hammer().bind("swipeup", function(){
    if(jQuery('#left_menu').is(':hidden')){
      jQuery('#left_menu').show().animate({ bottom: '+='+offsetHeight }, 400,'swing',function(){jQuery('.popover').show();});
      jQuery('#fake_arrow').hide();
     
    }
    });


  jQuery('#left_menu').data("hammer").get('swipe').set({direction: Hammer.DIRECTION_ALL}); 
  jQuery('#swipe-up-div').data("hammer").get('swipe').set({direction: Hammer.DIRECTION_ALL}); 
  jQuery('#fake_arrow').data("hammer").get('swipe').set({direction: Hammer.DIRECTION_ALL}); 



  jQuery('#word_span').on('click',function(){
    
    handleWordSpanClick();
  });

  jQuery('#location_span').on('click',function(){

    handleLocationSpanClick();

  })


 jQuery('#user_input').on('keyup',function(){

if(process_restarted){closeAllInfoWindows();process_restarted=false;}

 if(concept_selected &amp;&amp; location_selected &amp;&amp;stage==3){
 word_entered = true;

   setTimeout(function() {

      showPopUp();
   }, 100);
   
 }



 })



 } //success
    
  }); 



}


/**
 * Initializes the Modals at the start of the CS-Tool, when the user has not yet choosen a language, has not yet registred.
 * 
 */
function initWelcomeModal(){

  jQuery('#welcome_modal').on('show.bs.modal', function (e) {

       showCustomModalBackdrop();

       selectbox = jQuery('#language_select', this).selectBoxIt({theme: "bootstrap",defaultText: "Sprache ...",showFirstOption: false});
       jQuery(".infotext_container").mCustomScrollbar({ scrollButtons:{enable: true}});

       cycleText(jQuery("#modal_welcome"),welcome_texts,0,function(i){

            i-=1;
            jQuery("#language_selectSelectBoxItText").text(language_texts[i]);
            jQuery("#language_selectSelectBoxItText").attr('data-val',language_texts[i]);
       });

       cycleText(jQuery("#slogan_id"),slogan_texts,0);


       selectbox.on('open',function(){
            if(jQuery('#welcome_modal').find('.modal-content').height()&lt;340)  
            jQuery('.findicators').hide();
       });

       selectbox.on('close',function(){
            jQuery('.findicators').show();
       });

       selectbox.on('change',function(){

        // var select_index =  jQuery('#language_selectSelectBoxItOptions').find(".active").attr('data-id');
        var current_lang;
        var idx = jQuery(this).val();

        jQuery('#testdiv').hide();

        var select_index = 0;
        select_index = languages.indexOf(idx);


        current_language = select_index;

        var clone_1;
        var clone_2;

        if(!break_cycle){

        current_lang = jQuery("#modal_welcome").attr('lang_id');
        if(current_lang==4)current_lang=0;    
               
        clone_1 = jQuery("#modal_welcome").clone().attr('id','modal_welcome_c');
        clone_2 = jQuery("#slogan_id").clone().attr('id','slogan_id_c');    

        jQuery("#modal_welcome").replaceWith(clone_1);
        jQuery("#slogan_id").replaceWith(clone_2);

    

        break_cycle = true;

        }

        else{

        clone_1 = jQuery('#modal_welcome_c');    
        clone_2 = jQuery('#slogan_id_c');
        current_lang = clone_1.attr('lang_id');

        }


        if(select_index!=current_lang){
            clone_1.animate({opacity:0},801);
            clone_2.animate({opacity:0},801,function(){

            clone_1.text(welcome_texts[select_index]);
            clone_2.text(slogan_texts[select_index]);
            clone_1.animate({opacity:1},501);
            clone_2.animate({opacity:1},501);

            });

     }

     else{
        clone_1.css('opacity','1');
        clone_2.css('opacity','1');
        clone_1.text(welcome_texts[select_index]);
        clone_2.text(slogan_texts[select_index]);
     }
    
        clone_1.attr('lang_id',select_index);  
        clone_2.attr('lang_id',select_index);  
     
   });

   });
  
  jQuery('#welcome_modal').hammer().bind("swipeleft", function(e){

     if(jQuery(".active", e.target).index()==1){
        jQuery('#welcome_modal').modal('hide');
     
    }
    else{
      if(current_language!=-1){
     jQuery('#first_slider').carousel('next');
     }
     else{
         openLanguageModal();
     }    
    }

    });

  jQuery('#welcome_modal').hammer().bind("swiperight", function(){
    if(current_language!=-1){
    jQuery('#first_slider').carousel('prev');
    }
       else{
         openLanguageModal();
     }  

  }); 


  jQuery('.switch_page_icon').on('click',function(){
    if(current_language!=-1){
    jQuery('#first_slider').carousel('next');
    }

    else{
        openLanguageModal();
    }
  })

    jQuery('.c-back-button').on('click',function(){
    jQuery('#first_slider').carousel('prev');
  })

    jQuery('#first_slider').on('slide.bs.carousel', function (e) {


     if(jQuery(".active", e.target).index()==0){
        jQuery('.c-back-button').fadeIn('slow');
        jQuery('.infotext_head').text(instruction_heads[current_language]);
        jQuery(".text-left-span").text(instruction_texts[current_language]);
        jQuery("#go_span").text(go_texts[current_language]);
     }



     else{
       jQuery('.c-back-button').fadeOut('fast');
     }
    })


     jQuery('.startbutton').on('click',function(){
     jQuery('#welcome_modal').modal('hide');
    })



 jQuery('#welcome_modal').on('hidden.bs.modal', function () {
   //jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()});
   startMainTool();
 })


}

/**
 * [handleWordSpanClick description]
 * 
 */
function handleWordSpanClick(){

    if(allow_select) { 


    if(!jQuery('#concepts_modal').hasClass('fade')){
          jQuery('#concepts_modal').css('opacity',"1");
          jQuery('#concepts_modal').addClass('fade');
     }

     jQuery('#concepts_modal').modal({
              keyboard: false
            });

    if(jQuery('#custom_modal_backdrop').length&lt;1)showCustomModalBackdrop(); 

    }

}

/**
 * [handleLocationSpanClick description]
 * 
 */
function handleLocationSpanClick(){

  if(allow_select){
    
     if(!jQuery('#locations_modal').hasClass('fade')){
          jQuery('#locations_modal').css('opacity',"1");
          jQuery('#locations_modal').addClass('fade');
     }

    jQuery('#locations_modal').modal({
        keyboard: false
      }); 

    if(jQuery('#custom_modal_backdrop').length&lt;1)showCustomModalBackdrop();  
  }

} 

/**
 * [menu_is_up description]
 * 
 */
function menu_is_up() {
  startTutorial();
  jQuery('.highscoreicon').on('click',function(){
   buildHighScoreSelect();
  })
}

/**
 * Creates and returns a indexed array of all concepts in the user's language.
 * @param  {Array} concepts_cur_lang Array with all concepts in the language of the user.
 * @return {Object}                   Indexed Array containing concept id and the concept in the current language.
 */
function createConceptIndexList(concepts_cur_lang){
var result = {};

  for(var i=0;i&lt;concepts_cur_lang.length;i++){
    

    result[parseInt(concepts_cur_lang[i].id)] = {index:i,name:concepts_cur_lang[i].name};
  }

 return result;

}

/**
 * Builds an indexed array containing the number of entries for concepts that the user has entered and the concept's id.
 * @param  {Object} submitedAnswersIndexed indexed array containing all submited entries by the current user.
 * @return {Object}                        contains concept id and number of entries for the associated concept.
 */
function createAnswersToEntryNumbers(submitedAnswersIndexed){
var result = {};


   for(var key in submitedAnswersIndexed) {

      var entry = result[parseInt(submitedAnswersIndexed[key].concept_id)];
      if(entry==null) result[parseInt(submitedAnswersIndexed[key].concept_id)] = 1;
      else result[parseInt(submitedAnswersIndexed[key].concept_id)] +=1;

   }

  // for(var i=0;i&lt;submitedAnswers.length;i++){

  //   var entry = result[parseInt(submitedAnswers[i].concept_id)];

  //   if(entry==null) result[parseInt(submitedAnswers[i].concept_id)] = 1;
  //   else result[parseInt(submitedAnswers[i].concept_id)] +=1;

  // }

 return result;

}



/**
 * Initializes the Popover Tutorials.
 * 
 */
function startTutorial(){

tutorial_running = true;
stage = 1;
jQuery('#location_span').popover('show');


jQuery('.pop_location_span').parent().on('click',function(){
  handleLocationSpanClick();
}).addClass('c_hover');  



}

/**
 * Opens Language Modal for the user to choose prefered language.
 * 
 */
function openLanguageModal(){

    // jQuery('.message_modal_content').text("Bitte wählen Sie eine Sprache aus!");
        jQuery('#language_modal').modal({
                   keyboard: true
      });

}


/**
 * Builds Arrays containg the data for each row that will be displayed in the data tables.
 * @param  {Array} in_data Can be Concepts or Locations Arrays.
 * @param  {String} origin  concept or location
 * @return {Array}         Contains the html elements with the data for the data tables.
 */
function getTableData(in_data,origin){

  var data = [];


        for ( var i=0 ; i&lt;in_data.length; i++ ) {
        var res = {column1:{}};
        var name = in_data[i].name; 
        var filtered_name = replaceSpecialChars(name);
        if(filtered_name!=name)filtered_name+=" "+name;
        else filtered_name = name;


            if(origin=='concept' &amp;&amp; i&lt;important_concepts_count)res.column1.html='&lt;div  title="'+name+'" class="dataparent">&lt;span class="dataspan">&lt;i title="'+important_concepts_texts[current_language]+'" class="fa fa-exclamation-triangle" aria-hidden="true">&lt;/i>'+in_data[i].name+'&lt;/span>&lt;/div>';
            else if(origin=='concept') res.column1.html='&lt;div title="'+name+'" class="dataparent">&lt;span class="dataspan">'+name+'&lt;/span>&lt;/div>';
            else res.column1.html='&lt;div class="dataparent">&lt;span title="'+name+'" class="dataspan">'+name+'&lt;/span>&lt;/div>';

            res.column1.filtered_name = filtered_name;
            data.push(res);
        }

   return data;     

}


/**
 * Adds event listeners to all modals.
 */
function addModalListeners(){



  jQuery('#locations_modal .customclose').on('click',function(){
      jQuery('#locations_modal').modal('hide');
      jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
  })

    jQuery('#concepts_modal .customclose').on('click',function(){
      jQuery('#concepts_modal').modal('hide');
      jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
  })
 
   jQuery('#image_modal .customclose').on('click',function(){
      jQuery('#image_modal').modal('hide');
  })

    jQuery('#message_modal .customclose').on('click',function(){
      jQuery('#message_modal').modal('hide');
  })

      jQuery('#language_modal .customclose').on('click',function(){
      jQuery('#language_modal').modal('hide');
  })  

      jQuery('#register_modal .customclose').on('click',function(){
      jQuery('#register_modal').modal('hide');
      console.log("custom close");
  })

      jQuery('#location_list_modal .customclose').on('click',function(){
      jQuery('#location_list_modal').modal('hide');
  })  

 jQuery('#input_modal .customclose').on('click',function(){
      jQuery('#input_modal').modal('hide');
  }) 

    jQuery('#editInput_modal .customclose').on('click',function(){
      jQuery('#editInput_modal').modal('hide');
  }) 

  jQuery('#image_modal').hammer().bind("swipeleft", function(e){
     jQuery('#image_slider').carousel('next');
  });

    jQuery('#image_modal').hammer().bind("swiperight", function(e){
     jQuery('#image_slider').carousel('prev');
  });

     jQuery('#highscore_select_modal .customclose').on('click',function(){
      jQuery('#highscore_select_modal').modal('hide');
  })

       jQuery('#toplistmodal .customclose').on('click',function(){
      jQuery('#toplistmodal').modal('hide');
  })  

  jQuery('#why_register_modal .customclose').on('click',function(){
      prevent_backdrop=false;
      jQuery('#why_register_modal').modal('hide');
  })  

  jQuery("#icon_login").on('click',function(){
    jQuery('#register_modal').modal();
  })
 /* jQuery('#open_login_modal').on('click',function(){
      jQuery('register_modal').modal();
  })  */

 bindShowListeners_Modal();


}

/**
 * [bindShowListeners_Modal description]
 * 
 */
function bindShowListeners_Modal(){


    jQuery('#locations_modal').on('shown.bs.modal', function (e) {
     if(modals_initialized){
        datatable_locations.scroller.measure();
       setTimeout(function() {
        datatable_locations.scroller.measure();

      }, 10);

       displayTooltips(false);
       if(process_restarted){ closeAllInfoWindows();process_restarted=false;}
       setTimeout(function(){
       // jQuery('#locations_modal').find('input').focus();
       document.getElementById("focusinput").focus();
       },0);

       if(saved_location_index!=-1){
        datatable_locations.row(saved_location_index).scrollTo();
       }

     }

     else{   //extecuted once in initphase

     datatable_locations = createListModal(jQuery('#locations_modal'),location_data,"location"); 
  
      jQuery('[data-toggle="tooltip"]').tooltip();
    //bugfix for scrollerplugin (resize not working properly)

      var modal = jQuery(this);                         
      var oldheight = modal.find('.dataTables_scroll').height();                                    
         modal.find('input').on('input',function (){
         var height =  modal.find('.dataTables_scroll').height()
          if(oldheight!=height) {
                datatable_locations.scroller.measure();oldheight=height;
            } 
          })
     }

   })


    jQuery('#concepts_modal').on('shown.bs.modal', function (e) {

     if(modals_initialized){
      datatable_concepts.scroller.measure();
      setTimeout(function() {
        datatable_concepts.scroller.measure();
      }, 10);
      displayTooltips(false);
      if(process_restarted){closeAllInfoWindows();process_restarted=false;}
      do_image_modal = false;

      if(current_concept_index!=-1){
        datatable_concepts.row(current_concept_index).scrollTo();
      }

     }

    else{

       datatable_concepts = createListModal(jQuery('#concepts_modal'),concept_data,"concept"); 
     
        //bugfix for scrollerplugin (resize not working properly)
         var modal = jQuery(this);                         
         var oldheight = modal.find('.dataTables_scroll').height();  

          modal.find('input').on('input',function (){
          var height =  modal.find('.dataTables_scroll').height()
            if(oldheight!=height) {
              datatable_concepts.scroller.measure();oldheight=height;
            } 
          })
    } 

   })


     jQuery('#image_modal').on('shown.bs.modal', function (e) {
     
      setTimeout(function() {

          jQuery('#image_modal').find('#image_slider').carousel({
                interval: 3500
        })    

      setDynamicContent('image');
      }, 10);
     })

      jQuery('#locations_modal').on('hidden.bs.modal', function () {

         setTimeout(function() {displayTooltips(true);}, 200);  
         if(tutorial_running)showPopUp();
         jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
      })


      jQuery('#concepts_modal').on('hidden.bs.modal', function () {

       if(do_image_modal)jQuery('#image_modal').modal({});  

       if(!prevent_backdrop){
       setTimeout(function() {displayTooltips(true);}, 200); 
       if(tutorial_running)showPopUp();
       jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
       }  

      })


      jQuery('#message_modal').on('shown.bs.modal', function (e) {
      jQuery('#userAuesserungInput').focus();
      displayTooltips(false);
    })

    jQuery('#message_modal').on('hidden.bs.modal', function (e) {
      jQuery('#userAuesserungInput').focus();
      displayTooltips(true);
    })



    jQuery('#register_modal').on('shown.bs.modal', function (e) {
        prevent_backdrop=false;
        jQuery(this).find('.custom-modal-footer button').on('click',function(){

          jQuery('#register_modal').find('.custom-modal-footer button').removeClass('active_tab');
          jQuery(this).addClass('active_tab');

        })
        console.log("Register Modal shown");
    })

    jQuery('#register_modal').on('show.bs.modal', function (e) {
      if(!prevent_backdrop){
       displayTooltips(false);
      showCustomModalBackdrop();
      }
      console.log("Register Modal show");
      
    })


    jQuery('#register_modal').on('hidden.bs.modal', function (e) {
      displayTooltips(true);
     jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})  
     console.log("Register Modal Hidden");
    })

     jQuery('#input_modal').on('shown.bs.modal', function (e) {
      if(!jQuery('#location_list_modal').hasClass('in'))displayTooltips(false);
    })

    jQuery('#input_modal').on('show.bs.modal', function (e) {
         jQuery('#custom_modal_backdrop').css('z-index','10000');
    })


    jQuery('#input_modal').on('hidden.bs.modal', function (e) {
      if(!jQuery('#location_list_modal').hasClass('in')){displayTooltips(true);}
      jQuery('#custom_modal_backdrop').css('z-index','1049');
    })

    jQuery('#welcomeback_modal').on('shown.bs.modal', function (e) {
      setTimeout(function() {
         startMainTool();
      }, 500);
      
    })

    jQuery('#welcome_modal').on('shown.bs.modal', function (e) {
      jQuery('#custom_backdrop').fadeOut('slow',function(){jQuery(this).remove();});   
      
    })


      jQuery('#location_list_modal').on('show.bs.modal', function (e) {
      current_location_list_table = createLocationListTable(current_location_list_table_data);
      do_image_modal = false;
    })

       jQuery('#location_list_modal').on('shown.bs.modal', function (e) {
        displayTooltips(false);
        current_location_list_table.scroller.measure();
        current_location_list_table.columns.adjust();
    })


     jQuery('#location_list_modal').on('hidden.bs.modal', function () {

     setTimeout(function() {displayTooltips(true);}, 200);  
     if(tutorial_running)showPopUp();
     jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
     if(do_image_modal)jQuery('#image_modal').modal({});  
  })


     jQuery('#toplistmodal').on('show.bs.modal', function (e) {
       current_top_list_table = createTopListTable(current_highscoredata);
    })

      jQuery('#toplistmodal').on('shown.bs.modal', function (e) {
       prevent_backdrop = false;
       current_top_list_table.columns.adjust();
    })

     jQuery('#toplistmodal').on('hidden.bs.modal', function (e) {
      jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})  
      displayTooltips(true);
    })

     jQuery('#highscore_select_modal').on('hidden.bs.modal', function (e) {
      if(!prevent_backdrop){
         jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
         displayTooltips(true);
      }
    })

      jQuery('#highscore_select_modal').on('show.bs.modal', function (e) {
      displayTooltips(false);
    })


        jQuery('#why_register_modal').on('show.bs.modal', function (e) {
         if(!prevent_backdrop){
          showCustomModalBackdrop();
          displayTooltips(false);
        }
        })  
        

    jQuery('#why_register_modal').on('hidden.bs.modal', function (e) {
      if(!prevent_backdrop){
       displayTooltips(true);
        jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()})
      }
    })

   jQuery('#why_register_modal').on('shown.bs.modal', function (e) {
        if(prevent_backdrop)prevent_backdrop=false;
        })



}



function buildTable(list){
console.log(list.length);

var result = jQuery('&lt;tbody>'); 
   
  for(var i=0;i&lt;list.length;i++){
      var tr = jQuery('&lt;tr>&lt;/tr>');
      tr.attr('ref_id',list[i]['id']);
      tr.append(jQuery('&lt;td>'+list[i]['name']+'&lt;/td>'));
      result.append(tr);              
  }

return result;

}


function createListModal(modal,data,origin) {



var id;
var scrollY;

if(origin=="concept"){
  id = "#concept_modal_table";
  scrollY= "76vh"
}
else {
	id = "#location_modal_table";
	scrollY= "80vh"
}


var table = modal.find(id).DataTable(
      {

        data:data,
        columns: [
            { data: {
                _:    "column1.html",
                filter: "column1.filtered_name"
            } 
          },
        ],

      deferRender:    false,  //otherwise .node() won't always work
      scrollY:        scrollY,
      scrollX: false,
      scrollCollapse: true,
      info:false,
      ordering : false,

       scroller: {
       displayBuffer: 2,
    },


     fnInitComplete: function(settings) {

     

             var input =  modal.find('input');
             if(origin=='location'){input.attr('autofocus',"");input.attr('id','focusinput');} //id for js call in bind show listeners
             input.attr('autocomplete',"off");

              var buttonparent;

               if(!modals_initialized &amp;&amp; origin=="concept")	{

                buttonparent = jQuery('&lt;div class="list_modal_button_parent">&lt;/div>');
                jQuery('#concept_modal_table_filter').after(buttonparent);		

                   	var random_button = jQuery('&lt;div class="list_modal_button_in_search">&lt;i class="fa fa-random" aria-hidden="true">&lt;/i> '+random_texts[current_language]+'&lt;/div>');
                   	buttonparent.append(random_button);

                   	random_button.on('click',function(){

                    if(!prevent_randomclick)  {
                           do_image_modal = false;
                           prevent_randomclick = true;
                           if(jQuery('#concepts_modal').find('input').val()!="")datatable_concepts.search('').columns().search('').draw();
                           var rnd_idx = getRandomUnAnsweredConceptIndex();
                           
                           datatable_concepts.row(rnd_idx).scrollTo();
                           deSelectTableEntry(current_concept_index);
                           selectTableEntry(rnd_idx);
                           current_concept_index = rnd_idx;

                              var name = concepts_cur_lang[rnd_idx].name; 
                              concept_selected = true;  
                              var id= concepts_cur_lang[rnd_idx].id; 

                               jQuery('#word_span').text(name);
                               jQuery('#word_span').attr("data-id_concept",id);
                               jQuery('#word_span').attr("data-id_concept_index",rnd_idx);
                               setDynamicContent('list');
                               if(!jQuery('#why_register_modal').hasClass('in'))checkImageModal(id,name);

                           setTimeout(function() {prevent_randomclick=false}, 500);


                      }
                    })


                  var suggest_button = jQuery('&lt;div class="list_modal_button_in_search">&lt;i class="fa fa-plus" aria-hidden="true">&lt;/i> '+suggest_texts[current_language]+'&lt;/div>');
                  buttonparent.append(suggest_button);
                  if(!userLoggedIn)suggest_button.addClass('disabled_feature');
                  suggest_button.on('click',function(){
                  if(!userLoggedIn){
                       prevent_backdrop=true;
                       jQuery('#concepts_modal').modal('hide');
                       openWhyRegisterModal();
                  }
                  
                  else{

                       jQuery('.input_modal_content').empty();
                         var suggest_headline = jQuery('&lt;div class="suggest_headline">'+suggest_texts[current_language]+':&lt;/div>');
                         var suggest_field = jQuery('&lt;input class="suggest_field">&lt;/input>');
                         var suggest_button_submit = jQuery('&lt;div class="suggest_button_submit suggest_btn">'+submit_texts[current_language]+'&lt;/div>');
                         var feedback_div = jQuery('&lt;div class="feedback_suggest">'+feedback_texts[current_language]+'&lt;/div>');
                       jQuery('.input_modal_content').append(suggest_headline).append(suggest_field).append(suggest_button_submit);

                       jQuery('#input_modal').modal();

                       suggest_button_submit.off().on('click',function(){
                        if(suggest_field.val()==""){
                          markInputRed(suggest_field);
                        }

                        else{

                          sendSuggestEmail(suggest_field.val(),function(){
                               
                            suggest_button_submit.fadeOut('fast',function(){
                        	jQuery('.input_modal_content').append(feedback_div);	
                        	feedback_div.fadeIn('fast');

                        		setTimeout(function() {
                        		   jQuery('#input_modal').modal('hide');
                                   jQuery('.input_modal_content').empty();
                        		}, 1500);

                       		 })	
                          }) 	
                       
                        }
                        
                       })

                     
                  }     

                  })

               }


              modal.find('tbody').on('click', 'tr', function () {

                   var index  = table.row(this).index()
            
                    

                  if(origin=="concept"){

                   var name = concepts_cur_lang[index].name; 

                   concept_selected = true;  
                   var id= concepts_cur_lang[index].id; 

                   if(current_concept_index!=-1) deSelectTableEntry(current_concept_index);
                   selectTableEntry(index);

                    current_concept_index = index;
        
           
                    jQuery('#image_modal').modal('hide');

                    jQuery('#word_span').text(name);
                    jQuery('#word_span').attr("data-id_concept",id);
                    jQuery('#word_span').attr("data-id_concept_index",index);
                    setDynamicContent('list'); // for offset since hight of left menu could change

                    checkImageModal(id,name);
                    jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()});

                    /*END*/
                  }

                  else{ 
                    location_selected = true;

                    var name = locations[index].name;
                    var id= locations[index].id;

                    if(saved_location_index!=index){

                    var row = table.row(index).node();
                    jQuery(row).addClass('green_row');
                    var icon = jQuery('&lt;i class="fa fa-check" aria-hidden="true">&lt;/i>');
                    jQuery(row).find('.dataspan').prepend(icon);

                    }

                    //for unsetting green on pervious selection

                    if(saved_location_index!=-1 &amp;&amp; saved_location_index!=index){

                       var row = table.row(saved_location_index).node();
                       jQuery(row).removeClass('green_row'); 
                       jQuery(row).find('.fa-check').remove();
                    } 

                    saved_location_index = index; 
                    saved_location_name = name;


                    jQuery('#custom_modal_backdrop').fadeOut(function(){jQuery(this).remove()});
                    jQuery('#location_span').text(name);
                    jQuery('#location_span').attr("data-id_location",id);
                    setDynamicContent('list'); // for offset since hight of left menu could change

                    /*Show Gemeinde Grenzen*/
                 
                  jQuery('#image_modal').modal('hide'); 
                  var g_location = name;
                  var g_location_id = id;

                  var index = contains.call(existingLocations,g_location_id);
                  //console.log(existingLocations);  

                  showPolygon(g_location,g_location_id,index);
                  
                        /*END*/
                  }

              setTimeout(function() {modal.modal('hide');}, 220); //delay to show select effect
          })
          if(!modals_initialized){



                setTimeout(function() {modal.modal('hide');}, 1); //for closing modal on init
      
                  if(origin!='concept')locations_modal_modals_initialized =true;
                  else concepts_modal_initialized = true;

                  if(locations_modal_modals_initialized&amp;&amp;concepts_modal_initialized){
                    modals_initialized=true;
                    /*setTimeout(function() {
                      jQuery('#custom_backdrop').fadeOut('slow',function(){
                        if(language_is_set)jQuery('#welcomeback_modal').modal('hide');
                      });
                    }, 100);*/
                    if(language_is_set)jQuery('#welcomeback_modal').modal('hide');            
                  } 
                
          }  

        }
    } 
  );

 return table;
                 
}

/**
 * Build Image Slider
 * @param  {Array} _images  [description]
 * @param  {Array} _caption [description]
 * @return {String}          Div-element, containg images and their captions.
 */
function buildCarousel(_images,_caption){

jQuery('#image_modal').find('#image_slider').remove();

var result = jQuery('&lt;div id="image_slider" class="carousel slide" data-ride="carousel">');

if(_images.length>1){

var ol =    jQuery('&lt;ol class="carousel-indicators findicators">&lt;/ol>');

   for(var i=0;i&lt;_images.length;i++){

      var li = jQuery('&lt;li data-target="#image_slider" data-slide-to="'+i+'">&lt;/li>')
      if(i==0)li.addClass('active');
      ol.append(li);
   }

  result.append(ol);

}  

  var inner = jQuery('&lt;div class="carousel-inner" role="listbox">');

   for(var i=0;i&lt;_images.length;i++){

        var item = jQuery('&lt;div class="carousel-item">');
        if(i==0)item.addClass('active');
        var body =   jQuery('&lt;div class ="i_fake_body">&lt;/div>');
        var image_overlay = jQuery('&lt;div class ="i_overlay">&lt;/div>');
        var caption = jQuery('&lt;div class="carousel-caption first-info">'+_caption+'&lt;/div>');

        body.append(image_overlay);

        item.append(caption);
        item.append(body);
        inner.append(item);   

          body.css({'background':'url('+_images[i]+')',
          'background-repeat':'no-repeat',
          'background-size':"cover"  
          });
  
   }

   result.append(inner);
   if(_images.length>1)result.append(jQuery('&lt;a class="left carousel-control" href="#image_slider" role="button" data-slide="prev">&lt;span class="icon-prev" aria-hidden="true">&lt;/span>&lt;span class="sr-only">Previous&lt;/span>&lt;/a>&lt;a class="right carousel-control" href="#image_slider" role="button" data-slide="next">&lt;span class="icon-next" aria-hidden="true">&lt;/span>&lt;span class="sr-only">Next&lt;/span>&lt;/a>')); 

return result;
}

/**
 * [calculateCenter description]
 * 
 */
function calculateCenter() {
  center = map.getCenter();
}


function displayCoordinates(pnt) {

          var lat = pnt.lat();
          lat = lat.toFixed(4);
          var lng = pnt.lng();
          lng = lng.toFixed(4);
          console.log("Latitude: " + lat + "  Longitude: " + lng);
      }


/**
 * Change the language displayed. Used for Welcome Modal.
 * @param  {String}   element  [description]
 * @param  {Array}   textlist [description]
 * @param  {Int}   i        [description]
 * @param  {Function} callback [description]
 *
 */
function cycleText(element,textlist,i,callback){

if(!break_cycle){

    i++;  
    setTimeout(function() {
      element.attr('lang_id',i);      
      element.animate({opacity:0},800,function(){
      element.text(textlist[i]);
      element.animate({opacity:1},500,function(){
        requestAnimationFrame(function(){cycleText(element,textlist,i,callback)});
      });

    });


    if(i==textlist.length)i=0;

    }, 1300);

      if(typeof callback == "function")
      callback(i); 

}
                       
}

/**
 * Adjusts Visial Elements, solves problem with wordpress visialization.
 * 
 */
function moveElements(){
	if(userLoggedIn){
	 var loginout = jQuery(document).find('#wp-logout').detach();
	 loginout.addClass("btn btn-primary btn-lg");
	 jQuery('#log_in_div').append(loginout);

	 jQuery('.lwa').remove();
	}else{
		/*
		var loginout_notlogged = jQuery(document).find('.lwa-links-modal').detach();
		loginout_notlogged.addClass("btn btn-primary btn-lg");
		jQuery('#log_in_div').append(loginout_notlogged);
		*/
	}
}

/**
 * [initConceptModal description]
 */
function initConceptModal(){

  jQuery('#concepts_modal').css('opacity',"0");
  jQuery('#concepts_modal').modal({});

}

/**
 * [initLocationsModal description]
 */
function initLocationsModal(){

 jQuery('#locations_modal').css('opacity',"0");
 jQuery('#locations_modal').modal({});

}




/**
 * [showCustomBackdrop description]
 * 
 */
function showCustomBackdrop(){

var custom_backdrop = jQuery('&lt;div id="custom_backdrop">&lt;i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"">&lt;/i>&lt;/div>');
jQuery('body').append(custom_backdrop);
jQuery('#custom_backdrop').fadeIn();

}

/**
 * [showCustomModalBackdrop description]
 * 
 */
function showCustomModalBackdrop(){

jQuery('#custom_modal_backdrop').remove();
var custom_backdrop = jQuery('&lt;div id="custom_modal_backdrop">&lt;/div>');
jQuery('body').append(custom_backdrop);
jQuery('#custom_modal_backdrop').fadeIn('fast');

}


function addToolTips(elements){

for(var i=0;i&lt;elements.length;i++){

addToolTip(elements[i].name,elements[i].array);

}

}

function addToolTip(element,title_array){

var class_string = element.replace("#", "");
class_string = "pop_"+class_string;

var offsetstring = "0 0";
if(class_string == "pop_submitanswer")offsetstring="5 9";

jQuery(element).popover({
trigger:"manual",
placement:"top",
container:"body",
content:'&lt;div class="'+class_string+' custom_popover_content">'+title_array[current_language]+'&lt;/div>',
html:true,
animation:true,
offset:offsetstring


});

}

function addLoginToolTip(){

  jQuery('#icon_login').popover({
  trigger:"manual",
  placement:"left",
  container:"body",
  content:'&lt;div class="login_popover custom_popover_content">'+register_texts[current_language]+'&lt;/div>',
  html:true,
  animation:true,
  offset:"0 0"
  });

  jQuery('#icon_login').popover('hide');

}


function showLoginPopUp(){


 jQuery('#icon_login').popover('show');
        jQuery('.login_popover').parent().on('click',function(){
         jQuery('#register_modal').modal(); //{}
         console.log("Login Popover");
       }).addClass('c_hover'); 


}



function showPopUp(){

             if(tutorial_running &amp;&amp; location_selected &amp;&amp;!concept_selected){ 
              jQuery('#location_span').popover('hide');
              jQuery('#word_span').popover('show');
              stage=2;

               jQuery('.pop_word_span').parent().on('click',function(){
                         handleWordSpanClick();
               }).addClass('c_hover');  

            }

            else if(tutorial_running &amp;&amp; !location_selected &amp;&amp;!concept_selected){
              stage=1;
              jQuery('#location_span').popover('show');

              jQuery('.pop_location_span').parent().on('click',function(){
                handleLocationSpanClick();
              }).addClass('c_hover');  

            }

            else if(tutorial_running &amp;&amp; !location_selected &amp;&amp;concept_selected)  {
              jQuery('#word_span').popover('hide');jQuery('#location_span').popover('show');
              stage=1;  

              jQuery('.pop_location_span').parent().on('click',function(){
                handleLocationSpanClick();
              }).addClass('c_hover'); 
            }

            else if(tutorial_running &amp;&amp; location_selected &amp;concept_selected &amp;&amp;!word_entered)  {
              jQuery('#word_span').popover('hide');jQuery('#location_span').popover('hide');
              jQuery('#user_input').popover('show');
              jQuery('#user_input').val("");
              stage=3;  
              jQuery('.pop_user_input').parent().parent().css('top',"5px");

                 jQuery('.pop_user_input').parent().on('click',function(){
                         jQuery('#user_input').focus();
                          if(process_restarted){closeAllInfoWindows();process_restarted=false;}
               }).addClass('c_hover');  

            }

            if(word_entered &amp;&amp;stage&lt;4 &amp;&amp;location_selected &amp;&amp;concept_selected){
          
              if(stage!=4){
                jQuery('#user_input').popover('hide'); 
                jQuery('#submitanswer').popover('show');
                jQuery('.pop_submitanswer').parent().on('click',function(){

                    if(!submit_button_clicked){
                      saveWord();
                      submit_button_clicked = true;
                      setTimeout(function(){ submit_button_clicked = false; console.log('submit button: After saveword() ' + submit_button_clicked);}, 1000);
                    }

                }).addClass('c_hover');  

              }
              stage = 4;  
            }

            if(stage == 6){

              jQuery('#word_span').popover('hide');
              tutorial_running = false;
            }


}



function displayTooltips(show){

if(show)jQuery('.popover').css('opacity','1');
else jQuery('.popover').css('opacity','0');


}

/*jQuery(function () {
   jQuery('#register_modal').modal('toggle');
});*/

/*jQuery('#register_modal').on('shown.bs.modal', function () {
  jQuery('#lwa_user_login').focus()
})

jQuery('#login_slider').bind('slid.bs.carousel', function (e) {
       console.log('after slide');
       jQuery('#login_slider').data('ride', ""); 
      jQuery('#login_slider').carousel('pause');
});*/

function showSlide(x){
  switch(x){
    case "login":
      jQuery('.active').removeClass('active');
      jQuery('#login_slide').addClass('active');
    break;
    case "remember":
      jQuery('.active').removeClass('active');
      jQuery('#remember_slide').addClass('active');
    break;
    case "register":
      jQuery('.active').removeClass('active');
      jQuery('#register_slide').addClass('active');
    break;
  }
}

jQuery(".btn").mouseup(function(){
    jQuery(this).blur();
})

/*
jQuery(function () {
  jQuery('[data-toggle="popover"]').popover()
  jQuery('#login_div').popover('show');
})
*/

// jQuery('#icon_login').hover( function(){
//   jQuery(this).removeClass('fa-user-circle-o');
//    jQuery(this).addClass('fa-user-circle');
// },function(){
//    jQuery(this).removeClass('fa-user-circle');
//    jQuery(this).addClass('fa-user-circle-o');
// })

var enableSubmit = function(ele) {
    jQuery(ele).removeAttr("disabled");
    jQuery(ele).attr('enable',true);
    console.log("enable");
}



/*
jQuery('.fa-sign-out').on('mouseover', function(){
   jQuery(this).css('fa-2x');
})*/

/**
 * When user changes his entry the data is then been processed and updated to the server.
 * @param  {Int} id_auesserung [description]
 * @param  {Int} id_concept    [description]
 * @param  {Int} location_id   [description]
 * @param  {String} concept       [description]
 * @param  {Int} row_to_update [description]
 * @return {String}               [description]
 */
function editInputA(id_auesserung,id_concept,location_id,concept,row_to_update){


        jQuery('.input_modal_content').html(
            returnChangeInput()

            );

            jQuery('#input_modal').modal({
                       backdrop: 'static',
                       keyboard: false
            });
        
        jQuery('#input_modal').one('shown.bs.modal', function (e) {
        jQuery(this).find('button').on('click',function(){

             updateInput(concept,id_auesserung,id_concept,location_id,row_to_update);
        
          });     
        })



}


/**
 * @deprecated
 */
function editInput(location,concept,input_word){

jQuery('.message_modal_content').text("Sie haben diese Auesserungen schon gespeichert!");
						jQuery('.message_modal_content').html(returnChangeInput(location,concept,input_word));
						jQuery('#message_modal').modal({
		                   backdrop: 'static',
		                   keyboard: false
		                });


}

/*When location is choosen show polygon will check if this location's polygon exists else it will get it from the database*/
/**
 * After Choosing a locations from the location data tables. Get the location's polygon and display it. 
 * @param  {String} g_location    [description]
 * @param  {Int} g_location_id [description]
 * @param  {Int} index         [description]
 *
 */
function showPolygon(g_location,g_location_id,index){

   jQuery.ajax({
                            url: ajax_object.ajax_url,
                            type: 'POST',
                            data: {
                              action : 'getPolygonGemeinde',
                              location_id : g_location_id,
                              searchedGemeinde : g_location,                              
                            },
                            success : function( response ) {
                              
                                existingLocations.push(JSON.parse(response).location_id);
                                addGeometry(JSON.parse(response).polygonCoordinates,JSON.parse(response));
                                  //console.log('POlygon');
                                        if(map.getZoom()>6){
                                            map.setZoom(6);
                                            //console.log("zoomed");
                                          }
                                            var lat_g = parseGeoData(JSON.parse(response).centerCoordinates).get().lat();
                                            var lng_g = parseGeoData(JSON.parse(response).centerCoordinates).get().lng();
                                            centerCoordinates_locations.push({'id':JSON.parse(response).location_id,'lat':lat_g,'lng':lng_g});

                                            map.panTo({lat: lat_g, lng: lng_g});
                                            setTimeout(function() {
                                              smoothZoom(map, 11, map.getZoom());
                                            }, 200);  

                                            if(stage==5){
                                             stage = 6;

                                            setTimeout(function() {
                                            jQuery('#word_span').popover('show');
                                            displayTooltips(true);
                                            }, 2000); 
                                          }  
                                                           
                            }
                          });//ajax end
   
}


/*Filter Auesserungen Markers for the choosen Concept*/
/**
 * @deprecated
 */
function filterMarkers(id){
    for(var i = 0; i &lt; markers.length; i++){
        if(markers[i].concept_id.localeCompare(id) == 0){
            console.log('this concept');
            if(markers[i].type.localeCompare('userInput') != 0){
               markers[i].marker.setIcon(markershape);
            }
            if(markers[i].userMarker){
               markers[i].marker.setIcon(markershapeChoosen); 
            }
        }else{
          if(markers[i].type.localeCompare('userInput') != 0){
              markers[i].marker.setIcon(markershapeFiltered);
            }

            if(markers[i].userMarker){
               markers[i].marker.setIcon(markershapeChoosen);
            }

          } 
    }
}

/**
 * Replace special characters(from different languages) to siplify the search.
 * Used to simplify searching for concept or location that have spacial characters in different languages.
 * @param  {String} _in [description]
 * @return {String}     [description]
 */
function replaceSpecialChars(_in){


var res = _in.replace(/[äÄáÁàÀâÂãÃåÅæÆ]/g, 'a')
        .replace(/[çÇčČ]/g, 'c')
        .replace(/[éÉèÈêÊëË]/g, 'e')
        .replace(/[íÍìÌîÎïÏîĩĨĬĭ]/g, 'i')
        .replace(/[ñÑ]/g, 'n')
        .replace(/[öÖóÓòÒôÔœŒ]/g, 'o')
        .replace(/[ßšŠ]/g, 's')
        .replace(/[úÚùÙûÛ]/g, 'u')
        .replace(/[ýÝŷŶŸÿ]/g, 'n')
        .replace(/[áÁàÀâÂãÃåÅæÆ]/g, 'a')
        .replace(/[çÇ]/g, 'c')
        .replace(/[éÉèÈêÊëË]/g, 'e')
        .replace(/[íÍìÌîÎïÏîĩĨĬĭ]/g, 'i')
        .replace(/[ñÑ]/g, 'n')
        .replace(/[óÓòÒôÔœŒ]/g, 'o')
        .replace(/[ß]/g, 's')
        .replace(/[üÜúÚùÙûÛ]/g, 'u')
        .replace(/[ýÝŷŶŸÿ]/g, 'n')
        .replace(/[Žž]/g, 'z');

return res;

}

/**
 * Sets a random image as background for the different modals.
 * @param {Function} callback [description]
 * @param {Int}   modal_id [description]
 */
function setRandomTitelImage(callback,modal_id){

var number =  Math.floor(Math.random() * 7) + 1;
var jpg = "titel_" +number.toString()+".jpg"; 
var img_url = url.plugins_Url+'/assets/images/'+jpg;

   jQuery('&lt;img/>').attr('src', img_url).load(function() {
   jQuery(this).remove(); 

   jQuery(modal_id).find('.modal-body').css('background','url('+img_url+')');
   jQuery(modal_id).find('.modal-body').css('background-repeat','no-repeat');
   jQuery(modal_id).find('.modal-body').css('background-size','cover');

     if(typeof callback == "function"){
      callback();
     } 
    
  });

}

/**
 * Open location's data table.
 * @param  {Object} marker Location's marker.
 */
function openLocationListModal(marker){

  if(jQuery('#custom_modal_backdrop').length&lt;1)showCustomModalBackdrop();  

 

   current_location_list_object = aeusserungen_by_locationindex[marker.location_id];

   // find the right object from the array
    function rightOne(obj) {
        return obj.id == marker.location_id;
    }

    //the correct translation of the location
    var c_location_name = locations[locations.findIndex(rightOne)].name;
    current_location_list_object[Object.keys(current_location_list_object)[0]].ortsname=c_location_name; 
    current_location_list_object[Object.keys(current_location_list_object)[0]].usergen= marker.user_marker; 

    current_location_list_table_data = getLocationListTableData(current_location_list_object);

    jQuery('#location_list_table').DataTable().destroy();
    jQuery('#location_list_modal').find('.location_header_parent').remove();

    jQuery('#location_list_modal').modal();

}



/**
 * Build locations data for the data table.
 * @param  {Array} in_data [description]
 * @return {Array}         [description]
 */
function getLocationListTableData(in_data){

  var data = [];
  var i =0;
       for(var key in in_data) {

        var cur_data = in_data[key];  
        var user_data = false;
        var aeusserung_id = cur_data.id_aeusserung;

        if(submitedAnswers_indexed[aeusserung_id]!=null)user_data = true;

        var concept_name = cur_data.konzept;
        var author = cur_data.author;
        var word = cur_data.word;
        var concept_idx = concepts_index_by_id[cur_data.id_concept].index;
        var token = cur_data.tokenisiert;

        if(author.indexOf("anonymous") != -1) author=anonymous_texts[current_language];

        data[i] = [];

            if(concept_idx&lt;important_concepts_count)data[i].push('&lt;div ae_id="'+aeusserung_id+'" con_id="'+cur_data.id_concept+'" user_data="'+user_data+'" class="dataparent" title="'+concept_name+'" token="'+token+'">&lt;span class="dataspan">&lt;i title="'+important_concepts_texts[current_language]+'" class="fa fa-exclamation-triangle" aria-hidden="true">&lt;/i>'+concept_name+'&lt;/span>&lt;/div>');
            else data[i].push('&lt;div ae_id="'+aeusserung_id+'" con_id="'+cur_data.id_concept+'" user_data="'+user_data+'" class="dataparent" title="'+concept_name+'" token="'+token+'">&lt;span class="dataspan">'+concept_name+'&lt;/span>&lt;/div>');

            data[i].push('&lt;span class="c_answer_span dataspan"  title="'+word+'">\"'+word+'\"&lt;/span>');
            data[i].push('&lt;span class="authorspan dataspan"  title="'+author+'">('+author+')&lt;/span>');
            // data[i].push('&lt;div class="location_list_controls">&lt;div class="change_button_in_list rowbutton">&lt;i class="fa fa-pencil" aria-hidden="true">&lt;/i> '+change_input[current_language]+'&lt;/div>&lt;div class="delete_button_in_list rowbutton">&lt;i class="fa fa-trash-o" aria-hidden="true">&lt;/i> '+delete_input[current_language]+'&lt;/div>&lt;/div>');
         i++;
        }

   return data;     

}


function createLocationListTable(table_data){

var searching = false;
if(table_data.length>10)searching=true;

var table = jQuery('#location_list_modal').find('#location_list_table').DataTable(
      {

      data:table_data,
      deferRender:    false,  //otherwise .node() won't always work
      scrollY:        "75vh",
      scrollX: false,
      scrollCollapse: true,
      info:false,
      ordering : false,
      searching: searching,
      responsive:true,

    columns: [
    { "width": "45%" },
    { "width": "30%" },
    { "width": "25%" },
    // { "width": null}
    ],


       scroller: {
       displayBuffer: 15,
    },

     fnInitComplete: function(settings) {

     var name = current_location_list_object[Object.keys(current_location_list_object)[0]].ortsname;
     var num = Object.keys(current_location_list_object).length;
     var usergen = current_location_list_object[Object.keys(current_location_list_object)[0]].usergen;
     var tokenisiert = current_location_list_object[Object.keys(current_location_list_object)[0]].tokenisiert;

     var head = jQuery('&lt;div class="location_header_parent">&lt;div class="location_header_num">'+num+'&lt;/div>&lt;span class ="location_header">'+name+'&lt;/span>&lt;/div>');

      if(usergen){
          head.find('.location_header_num').addClass('user_generated_m');
   	   }


     if(searching){
	 jQuery('#location_list_modal').find('#location_list_table_filter').prepend(head);
	 head.css('display','inline-block');
	 jQuery('#location_list_modal').find('#location_list_table_filter').find('input').css('min-width','initial');
	 jQuery('#location_list_modal').find('#location_list_table_filter').find('label').css('width','initial').css('float','right').css('margin-top','-8px');
	 }
	 else{
	 jQuery('#location_list_modal').find('.custom_header').after(head);	
	 }

      var animating = false;

      jQuery('#location_list_modal').find('tbody').off().on('click', 'tr', function () {

      
      if(!animating){

      animating = true;

      if(jQuery(this).find('.dataparent').attr('user_data')=="true"){  

      /*display element depending if the Aeusserung is tokenisiert*/
      

      var token = jQuery(this).find('.dataparent').attr('token');
      if(token == "0"){
        var element_to_animate = ".location_list_controls";
      }else{
        var element_to_animate = ".tokenisiert";

      }

      if(jQuery(this).find(element_to_animate).css('right')=="-170px"){
        
        jQuery(this).find(element_to_animate).show().animate({
          right:["0", "swing"]
          }, 450, function() {
              jQuery(this).css('right','0px');
              animating = false;
          });
      }

      else{
         
          jQuery(this).find(element_to_animate).animate({
          right:[ "-170", "swing"]
          }, 450, function() {
            jQuery(this).hide().css('right','-170px');
            animating = false;
          });

      }

        var clicked_index  = table.row(this).index();


        table.rows().eq(0).each( function (index) {
              var row = table.row(index);
              var jrow = jQuery(row.node());
              if(clicked_index!=index &amp;&amp; (jrow.find(element_to_animate).css('right')=="0px")){

                 jrow.find(element_to_animate).animate({
                  right:[ "-170", "swing"]
                  }, 450, function() {
                       jrow.find(element_to_animate).hide().css('right','-170px');
                  });
              }
          });

      }

      else{

        var id = parseInt(jQuery(this).find('.dataparent').attr('con_id'));
        var name = jQuery(this).find('.dataparent').attr('title');
        setQ(name,id);
        jQuery('#location_list_modal').modal('hide');
        
      }  

      }

        })

    },

    createdRow: function (row, data, index ) {

      if(jQuery(row).find('.dataparent').attr('user_data')=="false"){

      jQuery(row).addClass('other_user_row');

      }

      else{
         jQuery(row).addClass('this_user_row');

            jQuery(row).append(jQuery('&lt;div class="location_list_controls">&lt;div class="change_button_in_list rowbutton">&lt;i class="fa fa-pencil" aria-hidden="true">&lt;/i> '+change_input[current_language]+'&lt;/div>&lt;div class="delete_button_in_list rowbutton">&lt;i class="fa fa-trash-o" aria-hidden="true">&lt;/i> '+delete_input[current_language]+'&lt;/div>&lt;/div>'));
            
            /*tokeniriest*/
            jQuery(row).append(jQuery('&lt;div class="tokenisiert">&lt;i class="fa fa-check-square-o" aria-hidden="true">&lt;/i>  ' +  permanently_saved[current_language]  + '&lt;/div>'));
            // jQuery(row).append(jQuery('&lt;div class="tokenisiert">&lt;div class="change_button_in_list rowbutton">&lt;i class="fa fa-pencil" aria-hidden="true">&lt;/i> '+'TEST'+'&lt;/div>&lt;div class="delete_button_in_list rowbutton">&lt;i class="fa fa-trash-o" aria-hidden="true">&lt;/i> '+'TEST'+'&lt;/div>&lt;/div>'));



            jQuery(row).find('.change_button_in_list').on('click',function(){

            var aeusserung_id = jQuery(row).find('.dataparent').attr('ae_id');
            var cur_obj = current_location_list_object[aeusserung_id];

            var row_to_update = jQuery(row);

            editInputA(aeusserung_id,cur_obj.id_concept,cur_obj.id_geo,cur_obj.konzept,row_to_update);

          })


          jQuery(row).find('.delete_button_in_list').on('click',function(){
    
              table.row(jQuery(this).parents('tr')).remove().draw();
              table.scroller.measure();
              
              var aeusserung_id = jQuery(row).find('.dataparent').attr('ae_id');
              var cur_obj = current_location_list_object[aeusserung_id];

              deleteInput(aeusserung_id,cur_obj.ortsname,cur_obj.id_concept,cur_obj.id_geo);

              var remaining_num = Object.keys(aeusserungen_by_locationindex[cur_obj.id_geo]).length
              jQuery('#location_list_modal').find('.location_header_num').text(remaining_num);

              if(check_for_current_user_entries(cur_obj.id_geo) &lt;= 0){
                jQuery('#location_list_modal').find('.location_header_num').removeClass('user_generated_m');
              }

              if(remaining_num==0){
                jQuery('#location_list_modal').modal('hide')
              }

          })
      }
  
    }

})

return table;

}

function checkImageModal(id,name){

  var myimages=[]; 

  myimages = images[id];
  if(myimages.length>0)do_image_modal=true;
  if(do_image_modal){
    var c =  buildCarousel(myimages,name);
    jQuery('#image_modal').find('.modal-body').append(c);  
}

}


function create_cookie(lang){
  createCookie("language_crowder",lang);
}

/**
 * @deprecated
 */
function refresh_page(){ /*Choose another language*/
  eraseCookie("language_crowder");
  console.log(document.cookie);
  location.reload();
}

/**
 * [reMeasureDatatables description]
 * 
 */
function reMeasureDatatables(){

     if(current_location_list_table!=null){
    current_location_list_table.scroller.measure();
   }

   if(datatable_locations!=null){
    datatable_locations.scroller.measure();
   }

    if(datatable_concepts!=null){
    datatable_concepts.scroller.measure();
   }

   if(current_top_list_table!=null){
    current_top_list_table.scroller.measure();
   }
}

/**
 * Sets a timer, after which a login/register pop up will show up.
 * 
 */
function startLoginTimer(){

        if(!jQuery('.login_popover').parent().parent().hasClass('in') &amp;&amp; !jQuery('#register_modal').hasClass('in')){

        setTimeout(function() {
        	if(!jQuery('.modal').hasClass('in')){showLoginPopUp();}
        	else{
        		 jQuery('.modal').one('hidden.bs.modal', function () {
        		 		showLoginPopUp();
        			})
        		}

          },3000);
        }
 
          setTimeout(function() {
          	if(!jQuery('#register_modal').hasClass('in')){
	          	hideAllOpenModals();
	          	setTimeout(function() {
	          	 openWhyRegisterModal();
	          	}, 1000);
          	}
          }, 90000);

}

/**
 * @deprecated 
 */
function checkLoginPopUp(){

if(session_answer_count==3){
    if(!jQuery('.login_popover').parent().parent().hasClass('in'))showLoginPopUp();
}

}

/**
 * [hideAllOpenModals description]
 */
function hideAllOpenModals(){
	jQuery('.modal').each(function(){

		if(jQuery(this).hasClass('in'))jQuery(this).modal('hide');
	})
}


function createUnansweredIndex(){

var allconceptindices =  new Array(Object.keys(concepts_index_by_id).length);

for(var i=0;i&lt;allconceptindices.length;i++){
allconceptindices[i] = i;
}

var return_object= {};

 for(var key in submitedAnswers_indexed) {
    var submitted_index = submitedAnswers_indexed[key].concept_index; 
    allconceptindices[submitted_index] = -1;
 }

 for(var i=0;i&lt;allconceptindices.length;i++){
  if(allconceptindices[i]!=-1) return_object[allconceptindices[i]] = concepts_cur_lang[allconceptindices[i]];
 }

return return_object;

}


function getRandomUnAnsweredConceptIndex(){

 var length = Object.keys(unanswered_concepts).length;

 var idx = Math.floor((Math.random() *length) + 0);
 return  Object.keys(unanswered_concepts)[idx];

}


function openHighScoreModal(array){

if(current_top_list_table!=null)current_top_list_table.destroy();

var table_data = [];

var i =0;
for(var key in array){
 i++; 
  var arr = array[key];

  if(arr[3]){
      table_data.push(['&lt;div class="highscorenumber">'+i+'.&lt;/div>','&lt;div class="concept_data" id="' + arr[3] + '">'+arr[0]+'&lt;/div>',arr[1]])
  }else if(arr[2]){
      table_data.push(['&lt;div class="highscorenumber">'+i+'.&lt;/div>','&lt;div class="obj_data" id="' + arr[2] + '">'+arr[0]+'&lt;/div>',arr[1]])
  }else{
    table_data.push(['&lt;div class="highscorenumber">'+i+'.&lt;/div>',arr[0],arr[1]])
  }

}

current_highscoredata = table_data;
jQuery('#highscore_select_modal').modal('hide');
jQuery('#toplistmodal').modal();


   jQuery('#toplistmodal .obj_data').on('click',function(){
      jQuery('#toplistmodal').modal('hide');
      var g_location_id = jQuery(this).attr('id');
      var g_location = jQuery(this).text();
      showPolygon(g_location,g_location_id);
      //console.log("CLICKED!!!");
  })

  jQuery('#toplistmodal .concept_data').on('click',function(){

          var id = parseInt(jQuery(this).attr('id'));
          var name = jQuery(this).text();
          setQ(name,id);
          jQuery('#toplistmodal').modal('hide');
          setDynamicContent();
  })

}

function buildHighScoreSelect(){

  setRandomTitelImage(function(){
    showCustomModalBackdrop();  
    

        getHighScoresFromDB(function(){


          jQuery('#best_user').one('click',function(){
            openHighScoreModal(top_users);
              jQuery('.highscoreheadlinespan').text(active_user_texts[current_language]);
              prevent_backdrop = true;
              }).text(active_user_texts[current_language])
          jQuery('#best_location').one('click',function(){
             jQuery('.highscoreheadlinespan').text(active_location_texts[current_language]);
            openHighScoreModal(top_locations);
              prevent_backdrop = true;
          }).text(active_location_texts[current_language])
          jQuery('#best_concept').one('click',function(){
            openHighScoreModal(top_concepts);
            jQuery('.highscoreheadlinespan').text(active_concept_texts[current_language]);
              prevent_backdrop = true;
          }).text(active_concept_texts[current_language])

          var icon = jQuery('&lt;i class="fa fa-pagelines leaf_icon_l" aria-hidden="true">&lt;/i>');
          var icon_r = jQuery('&lt;i class="fa fa-pagelines leaf_icon_r" aria-hidden="true">&lt;/i>');
          jQuery('.select_score_list').prepend(icon);
                jQuery('.select_score_list').append(icon_r);

          jQuery('#highscore_select_modal').modal({});
        }) //DB CALLBACK

    },"#highscore_select_modal"); //IMAGE CALLBACK
}


function createTopListTable(){


var table = jQuery('#toplistmodal').find('#top_list_table').DataTable(
      {

      data:current_highscoredata,
      deferRender:    false,  //otherwise .node() won't always work
      scrollY:        "75vh",
      scrollX: false,
      scrollCollapse: true,
      info:false,
      ordering : false,
      searching: false,
      responsive:true,

    columns: [
    { "width": "20%" },
    { "width": "60%" },
    { "width": "20%" },
    ],

       scroller: {
       displayBuffer: 15,
    },

     fnInitComplete: function(settings) {}

    })

return table;
}

function getHighScoresFromDB(callback){

               jQuery.ajax({
                    url: ajax_object.ajax_url,
                    type: 'POST',
                    data: {
                      action : 'getHighScores',
                      lang : current_language,
                      num: 10
                    },
                    success : function( response ) {

                      var result = JSON.parse(response);  
                      top_concepts = result["top_concepts"];
                      top_users =  result["top_users"];
                      top_locations = result["top_locations"];

                        if(typeof callback == "function")
                        callback(); 

                    }

                  });
}

function openWhyRegisterModal(){

 setRandomTitelImage(function(){

  jQuery('.why_register_headline').html(register_head_texts[current_language]);
  jQuery('.why_register_body').html(register_body_texts[current_language]);
  jQuery('.reg_yes').text(register_yes_texts[current_language]);
  jQuery('.reg_no').text(register_no_texts[current_language]);

   jQuery('.reg_yes').off().on('click',function(){
   prevent_backdrop=true;
   jQuery('#why_register_modal').modal('hide');
    jQuery('#register_modal').modal();
   })

   jQuery('.reg_no').off().on('click',function(){
    prevent_backdrop=false;
    jQuery('#why_register_modal').modal('hide');
  })


  jQuery('#why_register_modal').modal();

},"#why_register_modal"); //IMAGE CALLBACK

}


function sendSuggestEmail(entry, callback){

         jQuery.ajax({
                    url: ajax_object.ajax_url,
                    type: 'POST',
                    data: {
                      action : 'sendSuggestEmail',
                      entry: entry,
                      user : current_user,
                      email : user_email,
                    },
                    success : function( response ) {

                       callback(); 
                  }

            });

}


/*showPolygon(g_location,g_location_id,index)*/

/*jQuery('#toplistmodal .obj_id').on('click',function(){
      jQuery('#image_modal').modal('hide');
      var g_location_id = jQuery(this).attr('id');
      var g_location_id = jQuery(this).val();
      showPolygon(g_location,g_location_id,index);

})*/</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a>
	
		on 2017-09-26T17:15:41+02:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
